# $POMDP$速度规划器

> 在无法获知环境车辆驾驶意图的条件下完成当前的决策步骤，$POMDP$ 是一个合适的选择。

## 1.定义

$POMDP$通常被定义为 一个元组$(S,A,T,R,o,O,\gamma)$

- $Ｓ$为状态空间
- $Ａ$ 为动作空间
- $Ｔ$ 为条 件转移概率空间
- $Ｒ$ 为奖励函数
- $ｏ$为观测空间
- $Ｏ$为观测模型
- $\gamma$为折扣因子

## 2.状态空间

> 为了保证实时性要求，需要做剪枝处理

在弯道行驶的过程中，环境中的车辆都有可能对子自车产生影响，所以状态空间定义弯道中的所有车辆，该模型的装填空间定义为：
$$
S=	\left\{ S_0,S_1,S_2,...,S_n \right\}
$$

- $S_0$ 为自车状态
- $S_i(i=1,2,...,n)$ 表示环境中障碍物车辆状态
- $S_i = (s_i,v_i,r_i), \ \ i=0,1,2,...,n$
  - $s_i$ 为沿着当前路径实行的路径，
  - $v_i$ 为车辆的速度
  - $r_0$ 表示自车行驶的路径，$r_i(i \ge 1 )$ 表示环境中障碍物车辆行驶路径
    - 路径离散为一系列语义级操作：直行、左转、右转

## 3.动作空间

在弯道行驶的过程中，车辆的动作被定义为面向纵向加速度 $a_v$ 的控制 (方向盘转角有路径规划器来控制)，考虑到弯道的限度、成员舒适性以及车辆的性能，纵向加速度被离散为 $-4 \sim 2 m/s^2$，步长为$1 m/s^2$，最大速度被限制为 $35km/h$，动作空间定位为：
$$
A=a_v
$$

## 4.奖励函数

奖励函数引入$RSS$ 模型，综合考虑行驶效率、安全、舒适性、一致性等因素，奖励函数模型为：
$$
R=R_d + R_v + R_a + R_c
$$

- $R_d$ 为自车执行一个动作后到达规划模块预定位置的收益，当到达预定位置时给予较高的奖励，$R_d$收益定义为：
  $$
  R_d = \begin{cases}
  5000，&s_i \ge s_{end} \\
  0, &其他
  \end{cases}
  $$
  其中：$s_i$ 为之车沿当前路径行驶的距离，$s_{end}$ 为当前规划周期的终点位置

- $R_v$ 为速度收益，表示自车达到参考速度 $v_{ref}$ 的能力，$v$ 为车辆的实际速度，$R_v$收益定义为
  $$
  R_v = -(v-v_{ref})^2
  $$

- $R_a$ 为加速度收益，频繁的加速度变化会降低乘客的乘坐舒适性，$R_a$ 定义为：
  $$
  R_a = -100
  $$

- $R_e$ 为碰撞收益，表示自车保证安全的能力，$R_e$ 定义为：
  $$
  R_e = -10000
  $$

- 

## 5.观测空间

在弯道行驶的过程中，考虑到环境中障碍物车对自车的影响，观测空间被定义为除自车之外所有车辆，
$$
O= \left\{ O_1,O_2,...,O_n  \right\}
$$
假设忽略模型中传感器的误差，环境中每个障碍物的观测空间定义为：
$$
O_i = (v_i,x_i,y_i), \ \ i = 1,2,3,...,n
$$

## 6.障碍物车驾驶意图估计

环境中障碍物车的驾驶意图不可知，引入二维朴素贝叶斯分类器，利用该分类器来处理观测空间中环境车辆的位置信息 $D_{i,n}$，其中$i$ 表示车辆编号，$n= 1$ ,表示速度，$n = 2$ 表示位移。预测概率为：
$$
D_i=\begin{bmatrix}
D_{i,1} \\
D_{i,2}
\end{bmatrix}
=\begin{bmatrix}
|v'_{i} - v_{ref},p^{(j)}(s'_i) | \\
|| [x_i,y_i]^T - [x_{i,pre,r^{(j)}} y_{i,pre,r^{(j)}}]^T||_2
\end{bmatrix}
$$
精确预测环境中的障碍物车辆比较困难，但能够预测车辆驶入特定路径的概率为：
$$
P(r_i= r_j| D_{i,1},D_{i,2}) = \frac{P(r_j)P( D_{i,1},D_{i,2} |r_j)}{P(D_{i,1},D_{i,2})}
$$
在车辆驾驶意图不可知的条件下，假设环境 车辆驶入每条路径具有相同的先验概率，则有：
$$
P(r_i,r_1) = P(r_i,r_2) = P(r_i,r_3), \\ i=1,2,3(１代表左转代号；２代表直行代号；３代表右 转代号)
$$
环境中所有障碍物车的驾驶意图概率为：
$$
P(r_i= r_j| D_{i,1},D_{i,2}) = \frac{P(r_j)P( D_{i,1},D_{i,2} |r_j)}{\sum\limits^{I}_{l=1}P(D_{i,1}|r_l)P(D_{i,2}|r_i)}
$$
​				假设$P(D_{i,1/2}|r_j)$ 满足正太分布，$P(D_{i,1}|r_j) = N(0，4.0),P(D_{i,2}|r_j) = N(0，6.0)$

## 7.模型求解

