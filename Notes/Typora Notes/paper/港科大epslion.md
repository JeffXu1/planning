# EPSILON: An Efficient Planning System for Automated Vehicles in Highly Interactive Environments

## 论文主体

具有交互行为规划层和基于优化的运动规划层

- 行为交互层由部分可观察的马尔科夫决策过程形成(初步决策)
  - 效率的提升表现在将原始问题分解为数量有限的闭环策略评估
  - 引入带有安全机制的驾驶员模型，克服潜在的先验知识不完善带来的风险
- 运动规划
  - 采用**时空语义走廊**(`ssc`)来建立统一的建立复杂的环境约束模型
    - 根据行为规划提供的决策，优化轨迹
    - 遵循基于优化的方案。利用时空语义走廊对复杂语义的所有约束进行统一编码。采用分段贝塞尔曲线作为轨迹参数化方法，对其凸包和速迹特性进行了分析，提高整个轨迹的安全性和动力学可行性。

## 痛点问题的应对方案

- 不确定性建模与多智能体交互
  - 决策出由一系列覆盖规划视界的状态序列
  - 在决策的前提下，优化出一条安全、平滑的规划
  - 最后闭环执行

## 行为规划

- 纯几何推理，假设假设交通参与者的确定性轨迹预测，来检测碰撞，但预测问题多为不确定性和多模态，所以预测应该从概率的角度进行建模
- 本文是从多智能体交互的角度，来决定行为规划，采用`POMDP`方法，来处理不确定性下的问题。`MPDM`过度简化了自我载体的动作:每个候选策略只包含一个语义级动作，持续时间相当长，使`MPDM`成为单阶段`MDP`，这限制了决策的可操作性和智能水平。在本文中，我们保留了`POMDP`的多层结构，并利用领域知识和引导分支来实现更高的效率，同时保持灵活性。

## 运动规划

我们之前的方法[1]属于基于优化的方法。其关键特征是提出了统一的输入表示，即时空语义走廊结构，将各种语义元素构成的复杂约束包裹起来。这种输入表示在工程和调整约束方面节省了大量的工作。然而，与大多数运动规划方法一样，我们之前的方法仍然需要一个轨迹预测模块，没有捕获多智能体交互，这与交互感知行为规划方法相一致。在本文中，由于**预测模块耦合在行为规划中**，我们可以直接将决策与其他交通参与者的条件预期一起提供给运动规划层，这使得[1]中的运动规划器易于建模交互。

## EPSILON系统概述





`RSS`**(Responsibility Sensitive Safety)**的责任敏感安全模型

规则1：**不要撞到前面的车（纵向距离）**

1. 同向行驶

   ![img](https://5b0988e595225.cdn.sohucs.com/images/20180613/ba966a26ea2d443599b569650d48efab.jpeg)

   ![image-20220426190142161](/home/next/.config/Typora/typora-user-images/image-20220426190142161.png)

   - 人类驾驶汽车和自动驾驶汽车的参数可以不同。比如自动驾驶汽车的反应时间一般会比人类短，而且自动驾驶汽车可以比人类驾车的刹车更有效。因此，自动驾驶汽车的αmin,brake可以设置得更大些。
   - 不同路况下可以设置不同的参数（湿滑路面、冰、雪等）

   

2. 反向行驶

   ![img](https://img-blog.csdn.net/20180825222558266?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3l1eHVhbjIwMDYyMDA3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

![image-20220426190043955](/home/next/.config/Typora/typora-user-images/image-20220426190043955.png)

**规则2.与侧方车保持一定安全距离（横向距离）**

因突然并线而导致的追尾，责任在实施并线的车辆。这在现阶段的交通法规中，也是这么定责的，但这并不意味着自动驾驶汽车就可以不作为，`RSS`模型认为，即使旁边车道的车辆突然插入了自动驾驶车辆的前方，只要有足够的距离进行刹车，自动驾驶汽车也必须进行刹车避免碰撞。

![img](https://pic2.zhimg.com/80/v2-61a561dfcc80b8d3bc114c78f8902815_720w.jpg)

![image-20220426190420679](/home/next/.config/Typora/typora-user-images/image-20220426190420679.png)

注：u为允许距离有一个大小波动的范围；这里的v和a都是侧向的速度和加速度

**规则3：路权的享有原则：不争抢路权**

![img](https://5b0988e595225.cdn.sohucs.com/images/20180613/605270ec5c9a4f319b91d48039f54d10.jpeg)

![img](https://5b0988e595225.cdn.sohucs.com/images/20180613/817e172f2db4444cac315d651e1222ec.jpeg)

`RSS`并不是刻板地以路权做为唯一判断，比如在上图图中，蓝车来不及刹车闯入了红车的车道，红车也要采取刹车以避免碰撞。(按规定蓝车应该停车，让红车先过)

![img](https://5b0988e595225.cdn.sohucs.com/images/20180613/5e5f3009383848fa871679d023b72252.jpeg)

甚至，`RSS`模型还可以支持轻微横向位移来避免撞击

**规则4：注意自动驾驶汽车周边的盲区**

下图中的车辆正在通过一排停车位，一名儿童突然以速度10km/h的速度跑过来（比如在追球）。根据计算，10km/h的速度必须要保持15m的安全距离才可能避免碰撞发生。但此时汽车侧方的视野只有0.3m，显然无法满足安全要求。在这种情况下，RSS模型做了如下定义：

-在车辆可以发现目标的第一时间（Te）到反应时间结束时（Te + ρ），车辆没有加速，且到发生撞击或者完全停下来的时刻（Ts），车辆一直以不低于αmin_brake的加速度在刹车。

-从Te到Ts这段时间内，车辆的平均速度低于行人的平均速度。

这种情况下车辆是没有责任的。这个定义隐含的论点是：在发生撞击的时刻，车辆的速度比行人的速度低，或者两者都移动得很慢，从而使撞击的伤害降到最低。

![img](https://5b0988e595225.cdn.sohucs.com/images/20180613/301268f945264876a8c2728a909c6e4e.jpeg)

在这些不确定性高，视眼有限的场景，基本上都是要考虑 worst case

![img](https://img-blog.csdn.net/2018072521452760?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3l1eHVhbjIwMDYyMDA3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)



对于可靠性，使用了`NHTSA`的场景进行测试，cover了99.4%的碰撞情况。

![img](https://img-blog.csdn.net/20180725214606234?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3l1eHVhbjIwMDYyMDA3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

RSS描述的不是驾驶策略，而是对驾驶策略的结果进行安全判定，通过这种规则的设定，希来提前预防、及时避免事故的发生，以及在事故无法避免时，如何将伤亡降到最低。同时，保护OEM厂商的正当权益，避免受到来自社会或监管方不合理的责任分配。

另一方面，RSS在定义不同场景下的危险情况、正确反应、事故责任划分中，是基于人类驾驶员的常识，而非仅仅法律法规。





# 时空安全走廊

## 之前的方法

- 自动驾驶汽车 (AV) 的 RAJECTORY 生成
  在复杂的城市环境中是具有挑战性的，因为有
  有许多语义元素（例如，动态代理、交通信号灯、
  限速、停车标志和车道几何形状）。不同类型的
  语义元素可能有不同的数学描述
  例如障碍、约束和成本[1]。 调音很重要
  不同语义元素组合的效果
  以便该公式可以很好地推广到所有组合
  语义元素[2]。 因此，有必要描述
  不同种类的语义元素以统一的方式，使得
  语义元素的类型和组合不影响
  规划绩效。

- 大多数现有的基于优化的[3]，
  [4] 和基于格的 [5]-[7] 运动规划器尝试检查或
  在一系列采样点上强制执行约束。 然而，这些
  方法可能无法检测或解决之间的不可行点
  两个样本点

## SSC的不同之处

- SSC 的动机是⼤多数语义元素可以呈现为时空障碍或时空域的特 定范围内的约束。 SSC 的关键特性是它对**不同类型的语义元素的抽象**。本质上，SSC 由⼀系列相互连接的⽆碰撞⽴⽅体组成，具有由语义元素构 成的动态约束。我们提出了⼀个 SSC ⽣成过程来⽣成和拆分⽴⽅体，以便 可以正确关联动态约束。给定统⼀的 SSC 表⽰，轨迹⽣成问题归结为在满⾜动态约束的同时 在 SSC 内⽣成最优轨
- 方法
  - 提供了⼀个⼆次规划（QP）公 式，该公式通过使⽤分段⻉塞尔曲线参数化来保证⽣成轨迹的安全性和 可行性。所提出的公式建⽴在凸包和⻉塞尔曲线的全息图属性
  - 要构建 SSC，需要四个要素，即由语义元素组成的语义图、动态代理的预 测轨迹、前向模拟状态和由路线信息给出的参考线
  - 我们不是在笛卡尔坐标中⽣成⾛廊，⽽是采⽤ Frenét 框架表⽰，因为 ⼤多数语义元素都与⻋道⼏何相关联。例如，限速、交通灯和停⻋标志通 常与⻋道的某个纵向范围相关联。此外，由于类⼈驾驶行为通常可以解耦 为横向运动和纵向运动，因此在这两个⽅向上建模⾃由空间⽐在笛卡尔 坐标中建模⾃由空间更⾃然。
- 约束
  -  Obstacle-Like Semantic Elements(障碍语义元素)：许多语义元素具有物理意 义，不允许驱动slt域的某个部分。例如，静态障碍物可以被视为跨越整个 时间轴的障碍物，动态障碍物根据预测的轨迹，可以将其视为时域中的⼀ 系列静态障碍物，⽽红灯可以渲染为占据特定纵向位置和时间段的障碍 物。在将语义元素等障碍物渲染到 slt 域之后，配置空间是⼀个 3-D 占⽤ ⽹格。
  - 类约束语义元素：除了类障碍语义元素外，许多语义元素表⽰动态 约束或时间约束。例如，速度限制和停⻋标志可以被视为速度限制。还有⼀些语义元素会造成时间限制。例如，在交叉⻋道时，换道的总时间不应过⻓
  - 我们为所有类似约束的语义元素提出了⼀个统⼀的表⽰，即语义边 界。例如，可以将速度限制视为应⽤于纵向范围[sbegin, send] 的速度约 束，其中sbegin和send是两个语义边界。变道持续时间约束可以看作是 应⽤于当前⻋道的横向范围[dbegin, dend]的时间约束。本质上，语义边 界代表了某个语义元素开始和停⽌⽣效的位置。
- 语义元素分类
  - 障碍物语义元素，不运行驶入
  - 语义元素边界
    - 纵向：速度限制( a speed limit)
    - 横向：换道时间约束

- 语义走廊生成步骤

SSC 是由于大多数语义元素可以是呈现为时空域一定范围内的时空障碍或约束。的主要特点
SSC 是它对不同类型语义元素的抽象。本质上，SSC 由一系列相互连接的具有动态约束的无碰撞立方体语义元素。我们提出了一个 SSC 生成过程生成并拆分立方体，以便动态约束
可以正确关联。给定统一的 SSC 表示，轨迹生成问题归结为生成最优轨迹在 SSC 内，同时满足动态约束。在这个信中，我们提供了二次规划 (QP) 公式使用 piec 保证生成轨迹的安全性和可行性
